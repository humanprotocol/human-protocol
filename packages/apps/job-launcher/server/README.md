<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://s2.coinmarketcap.com/static/img/coins/64x64/10347.png" width="100" alt="Human Protocol" /></a>
</p>

[circleci-image]: https://img.shields.io/circleci/build/github/nestjs/nest/master?token=abc123def456
[circleci-url]: https://circleci.com/gh/nestjs/nest
<h1 align="center">Job Launcher</h1>
  <p align="center">API that allows Human Protocol users to create jobs.</p>

<p align="center">
  <a href="https://github.com/humanprotocol/human-protocol/blob/main/LICENSE">
    <img alt="License: MIT" src="https://img.shields.io/badge/license-MIT-yellow.svg" target="_blank" />
  </a>
  
</p>

## âœ¨ Demo
First, let's install the dependencies, `yarn` is used as a package manager:
```bash
$ yarn install
```

The application needs access to environment variables in order to work correctly, for this, create one of the `.env.<NODE_ENV>` files, depending on the state of your environment:

```bash
$ export NODE_ENV=development
```

Use the `.env.example` file as an example to create a configuration file with certain environment variables:

```bash
$ cp .env.example .env.development
```

Next, the requirement that the application puts forward is to set up a database, for this there are two different options, `manually` or using `docker`.

### Set up the database manually
First of all, postgres needs to be installed, please see here <a href="https://www.postgresql.org/download/">please see here</a>.

Then run the following commands in the postgres console to create the database and issue permissions:
```bash
$ CREATE DATABASE "job-launcher";
$ CREATE USER operator WITH ENCRYPTED PASSWORD 'qwerty';
$ GRANT ALL PRIVILEGES ON DATABASE "job-launcher" TO "operator";
$ \c "job-launcher" postgres
$ GRANT CREATE ON SCHEMA public TO operator;
```
Now we're ready to run the migrations:
```bash
yarn migration:run
```

### Set up the database with Docker
To run with docker, you need to enter the following command, which raises the container with postgres and runs the migrations:

```bash
yarn docker:db:up
```

## Running integration tests

Integration tests ensure the proper functioning of the services provided by the application. Before running the tests, ensure that your environment and dependencies are set up correctly.

### Prerequisites

1. **Clone the repository:**

    ```bash
    git clone https://github.com/humanprotocol/human-protocol.git
    cd human-protocol/scripts
    ```

2. **Run the local environment setup script using the provided `make` command:**

    ```bash
    make fortune
    ```

    This script will set up your local environment using the configurations specified in `.env.local`, which is generated during the setup process.

### Configuration

All necessary configurations can be found in the `.env.local` file generated by the `make fortune` command in the previous step.

### Running tests

To execute the integration tests, run the following command in your terminal:

```bash
yarn test:integration
```


## ðŸš€ Usage
### Running the app

```bash
# development
$ yarn run start

# watch mode
$ yarn run start:dev

# production mode
$ yarn run start:prod

# debug mode
$ yarn run start:debug
```

### Testing the app

```bash
# unit tests
$ yarn run test

# e2e tests
$ yarn run test:e2e

# test coverage
$ yarn run test:cov
```

### Migrations

```bash
# Create new migration
$ yarn migration:create addNameTable

# Generate new migration
$ yarn migration:generate addNameTable

# Revert latest migration
$ yarn migration:revert

# Run all pending migrations
$ yarn migration:run

# Show all migrations
$ yarn migration:show
```

### Docker

```bash
# Up a postgres container and run migrations
$ docker:db:up

# Down postgres container
$ docker:db:down
```
